window;import{jsx as e,Fragment as r,jsxs as n}from"react/jsx-runtime";import{DynamicComponent as t,RpcContext as o,useAsync as s,InteractiveCode as a,mapRpcError as i}from"@leanprover/infoview";import*as l from"react";function c({pos:o,html:s}){if("text"in s)return e(r,{children:s.text});if("element"in s){const[r,n,t]=s.element,a={};for(const[e,r]of n)a[e]=r;const i=t.map((e=>c({pos:o,html:e})));return"hr"===r?e("hr",{}):0===i.length?l.createElement(r,a):l.createElement(r,a,i)}if("component"in s){const[n,a,i]=s.component,l=i.map((e=>c({pos:o,html:e}))),p={...a,pos:o};return 0===l.length?e(t,{pos:o,hash:n,props:p}):e(t,{pos:o,hash:n,props:p,children:e(r,{children:l})})}return n("span",{className:"red",children:["Unknown HTML: ",JSON.stringify(s)]})}function p({expr:t}){const c=l.useContext(o),p=s((()=>c.call("ProofWidgets.ppExprTagged",{expr:t})),[t]);return"resolved"===p.state?e(a,{fmt:p.value}):"rejected"===p.state?n(r,{children:["Error: $",i(p.error).message]}):e(r,{children:"Loading.."})}function d({pos:t,expr:a,name:p}){const d=l.useContext(o),u=s((()=>async function(e,r,n){return await e.call("ProofWidgets.getExprPresentation",{expr:r,name:n})}(d,a,p)),[d,a,p]);return"resolved"===u.state?e(c,{pos:t,html:u.value}):"loading"===u.state?e(r,{children:"Loading.."}):n(r,{children:["Error: ",i(u.error).message]})}function u({pos:t,expr:a}){const c=l.useContext(o),u=s((()=>async function(e,r){return(await e.call("ProofWidgets.applicableExprPresenters",{expr:r})).presenters}(c,a)),[c,a]),[m,h]=l.useState(void 0);return"rejected"===u.state?n(r,{children:["Error: ",i(u.error).message]}):"resolved"===u.state&&0<u.value.length?n("div",{style:{display:"flow-root"},children:[m&&"none"!==m?e(d,{pos:t,expr:a,name:m}):e(p,{expr:a}),n("select",{className:"fr",onChange:e=>h(e.target.value),children:[e("option",{value:"none",children:"Default"},"none"),u.value.map((r=>e("option",{value:r.name,children:r.userName},r.name)))]})]}):e(p,{expr:a})}function m({pos:t,goals:a,loc:c}){const p=l.useContext(o),d=s((async()=>{const e=function(e,r){for(const n of e)if(n.mvarId===r.mvarId)return n;throw new Error(`Could not find goal for location ${JSON.stringify(r)}`)}(a,c);if(void 0===e.ctx)throw new Error("Lean server 1.1.2 or newer is required.");return(await p.call("ProofWidgets.goalsLocationsToExprs",{locations:[[e.ctx,c]]})).exprs[0]}),[p,a,c]);return"loading"===d.state?e(r,{children:"Loading.."}):"rejected"===d.state?n(r,{children:["Error: ",i(d.error).message]}):e(u,{pos:t,expr:d.value})}function h(t){return n("details",{open:!0,children:[e("summary",{className:"mv2 pointer",children:"Selected expressions"}),t.selectedLocations.length>0?t.selectedLocations.map((r=>e(m,{pos:t.pos,goals:t.goals,loc:r},JSON.stringify(r)))):e(r,{children:"Nothing selected. You can use shift-click to select expressions in the goal."})]})}export{h as default};
